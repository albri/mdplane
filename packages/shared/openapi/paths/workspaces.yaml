# ==============================================================================
# WORKSPACE MANAGEMENT ENDPOINTS
# Nuclear operations requiring OAuth session (Tier 2)
# ==============================================================================

/w/{key}/workspace:
  patch:
    operationId: renameWorkspaceViaWriteKey
    tags:
      - Workspaces
    summary: Rename workspace via write key
    security:
      - capabilityKeyAuth: []
    description: |
      Rename a workspace using a workspace-scoped write capability key.

      This endpoint is intended for capability-key workflows that need to
      rename workspaces without an OAuth session.
    parameters:
      - $ref: '../components/parameters.yaml#/capabilityKey'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/WorkspaceRenameRequest'
    responses:
      '200':
        description: Workspace renamed successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/WorkspaceRenameResponse'
      '400':
        $ref: '../components/responses.yaml#/BadRequest'
      '403':
        description: Key is not allowed to rename workspace
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/Error'
            example:
              ok: false
              error:
                code: "FORBIDDEN"
                message: "Only workspace-scoped write keys can rename workspaces"
      '404':
        $ref: '../components/responses.yaml#/NotFound'

/workspaces/{workspaceId}:
  delete:
    operationId: deleteWorkspace
    tags:
      - Workspaces
    summary: Delete workspace
    description: |
      Permanently delete a workspace and ALL its contents.
      
      **⚠️ DESTRUCTIVE OPERATION - CANNOT BE UNDONE**
      
      This will delete:
      - All files and folders
      - All capability URLs (they become invalid)
      - All API keys
      - All webhooks
      - Ownership information
      
      **Requires:** OAuth session (GitHub/Google) and workspace ownership.
    security:
      - oauthSession: []
    parameters:
      - $ref: '../components/parameters.yaml#/workspaceId'
    responses:
      '200':
        description: Workspace deleted successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/SuccessResponse'
            example:
              ok: true
              data:
                message: "Workspace deleted successfully"
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../components/responses.yaml#/NotFound'

/workspaces/{workspaceId}/name:
  patch:
    operationId: renameWorkspace
    tags:
      - Workspaces
    summary: Rename workspace
    description: |
      Rename a workspace via OAuth account controls session.

      **Requires:** OAuth session (GitHub/Google) and workspace ownership.
    security:
      - oauthSession: []
    parameters:
      - $ref: '../components/parameters.yaml#/workspaceId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/WorkspaceRenameRequest'
    responses:
      '200':
        description: Workspace renamed successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/WorkspaceRenameResponse'
      '400':
        $ref: '../components/responses.yaml#/BadRequest'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../components/responses.yaml#/NotFound'

/workspaces/{workspaceId}/rotate-all:
  post:
    operationId: rotateAllUrls
    tags:
      - Workspaces
    summary: Rotate all capability URLs
    description: |
      Regenerate ALL capability URLs for this workspace.
      
      **⚠️ DESTRUCTIVE OPERATION**
      
      This will:
      - Generate new read/append/write keys for all files/folders
      - Invalidate ALL existing capability URLs
      - Break all integrations using old URLs
      - Return newly generated root read/append/write keys once in the response

      Use this when you suspect keys have been compromised.
      
      **Requires:** OAuth session (GitHub/Google) and workspace ownership.
    security:
      - oauthSession: []
    parameters:
      - $ref: '../components/parameters.yaml#/workspaceId'
    responses:
      '200':
        description: All URLs rotated successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/RotateAllResponse'
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../components/responses.yaml#/NotFound'

# NOTE: /workspaces/{workspaceId}/transfer is intentionally not implemented.
# This is a future feature for transferring workspace ownership.
